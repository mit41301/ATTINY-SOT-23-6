
AVRASM ver. 2.2.7  C:\Users\mit41301\Documents\Atmel Studio\attiny10_tetris-main\tetris.asm Wed Nov 19 21:00:58 2025

[builtin](2): Including file 'C:/Program Files (x86)\Atmel\Studio\7.0\Packs\atmel\ATtiny_DFP\1.3.229\avrasm\inc\tn10def.inc'
C:\Users\mit41301\Documents\Atmel Studio\attiny10_tetris-main\tetris.asm(32): warning: Register r26 already defined by the .DEF directive
C:\Users\mit41301\Documents\Atmel Studio\attiny10_tetris-main\tetris.asm(33): warning: Register r27 already defined by the .DEF directive
C:\Users\mit41301\Documents\Atmel Studio\attiny10_tetris-main\tetris.asm(37): warning: Register r17 already defined by the .DEF directive
C:\Users\mit41301\Documents\Atmel Studio\attiny10_tetris-main\tetris.asm(43): warning: Register r16 already defined by the .DEF directive
C:\Users\mit41301\Documents\Atmel Studio\attiny10_tetris-main\tetris.asm(44): warning: Register r17 already defined by the .DEF directive
C:\Users\mit41301\Documents\Atmel Studio\attiny10_tetris-main\tetris.asm(53): warning: Register r16 already defined by the .DEF directive
C:\Users\mit41301\Documents\Atmel Studio\attiny10_tetris-main\tetris.asm(54): warning: Register r17 already defined by the .DEF directive
C:\Users\mit41301\Documents\Atmel Studio\attiny10_tetris-main\tetris.asm(55): warning: Register r18 already defined by the .DEF directive
C:\Users\mit41301\Documents\Atmel Studio\attiny10_tetris-main\tetris.asm(56): warning: Register r19 already defined by the .DEF directive
C:\Users\mit41301\Documents\Atmel Studio\attiny10_tetris-main\tetris.asm(60): warning: Register r16 already defined by the .DEF directive
C:\Users\mit41301\Documents\Atmel Studio\attiny10_tetris-main\tetris.asm(61): warning: Register r17 already defined by the .DEF directive
C:\Users\mit41301\Documents\Atmel Studio\attiny10_tetris-main\tetris.asm(62): warning: Register r18 already defined by the .DEF directive
C:\Users\mit41301\Documents\Atmel Studio\attiny10_tetris-main\tetris.asm(63): warning: Register r19 already defined by the .DEF directive
C:\Users\mit41301\Documents\Atmel Studio\attiny10_tetris-main\tetris.asm(67): warning: Register r24 already defined by the .DEF directive
C:\Users\mit41301\Documents\Atmel Studio\attiny10_tetris-main\tetris.asm(70): warning: Register r28 already defined by the .DEF directive
C:\Users\mit41301\Documents\Atmel Studio\attiny10_tetris-main\tetris.asm(71): warning: Register r30 already defined by the .DEF directive
C:\Users\mit41301\Documents\Atmel Studio\attiny10_tetris-main\tetris.asm(72): warning: Register r29 already defined by the .DEF directive
C:\Users\mit41301\Documents\Atmel Studio\attiny10_tetris-main\tetris.asm(73): warning: Register r31 already defined by the .DEF directive
[builtin](2): Including file 'C:/Program Files (x86)\Atmel\Studio\7.0\Packs\atmel\ATtiny_DFP\1.3.229\avrasm\inc\tn10def.inc'
                                 
                                 ;.include "tn10def.inc"
                                 
                                 ;***** Created: 2011-02-09 12:03 ******* Source: ATtiny10.xml ************
                                 ;*************************************************************************
                                 ;* A P P L I C A T I O N   N O T E   F O R   T H E   A V R   F A M I L Y
                                 ;* 
                                 ;* Number            : AVR000
                                 ;* File Name         : "tn10def.inc"
                                 ;* Title             : Register/Bit Definitions for the ATtiny10
                                 ;* Date              : 2011-02-09
                                 ;* Version           : 2.35
                                 ;* Support E-mail    : avr@atmel.com
                                 ;* Target MCU        : ATtiny10
                                 ;* 
                                 ;* DESCRIPTION
                                 ;* When including this file in the assembly program file, all I/O register 
                                 ;* names and I/O register bit names appearing in the data book can be used.
                                 ;* In addition, the six registers forming the three data pointers X, Y and 
                                 ;* Z have been assigned names XL - ZH. Highest RAM address for Internal 
                                 ;* SRAM is also defined 
                                 ;* 
                                 ;* The Register names are represented by their hexadecimal address.
                                 ;* 
                                 ;* The Register Bit names are represented by their bit number (0-7).
                                 ;* 
                                 ;* Please observe the difference in using the bit names with instructions
                                 ;* such as "sbr"/"cbr" (set/clear bit in register) and "sbrs"/"sbrc"
                                 ;* (skip if bit in register set/cleared). The following example illustrates
                                 ;* this:
                                 ;* 
                                 ;* in    r16,PORTB             ;read PORTB latch
                                 ;* sbr   r16,(1<<PB6)+(1<<PB5) ;set PB6 and PB5 (use masks, not bit#)
                                 ;* out   PORTB,r16             ;output to PORTB
                                 ;* 
                                 ;* in    r16,TIFR              ;read the Timer Interrupt Flag Register
                                 ;* sbrc  r16,TOV0              ;test the overflow flag (use bit#)
                                 ;* rjmp  TOV0_is_set           ;jump if set
                                 ;* ...                         ;otherwise do something else
                                 ;*************************************************************************
                                 
                                 #ifndef _TN10DEF_INC_
                                 #define _TN10DEF_INC_
                                 
                                 
                                 #pragma partinc 0
                                 
                                 ; ***** SPECIFY DEVICE ***************************************************
                                 .device ATtiny10
                                 #pragma AVRPART ADMIN PART_NAME ATtiny10
                                 .equ	SIGNATURE_000	= 0x1e
                                 .equ	SIGNATURE_001	= 0x90
                                 .equ	SIGNATURE_002	= 0x03
                                 
                                 #pragma AVRPART CORE CORE_VERSION AVR8L_0
                                 
                                 
                                 ; ***** I/O REGISTER DEFINITIONS *****************************************
                                 ; NOTE:
                                 ; Definitions marked "MEMORY MAPPED"are extended I/O ports
                                 ; and cannot be used with IN/OUT instructions
                                 .equ	SREG	= 0x3f
                                 .equ	SPL	= 0x3d
                                 .equ	SPH	= 0x3e
                                 .equ	CCP	= 0x3c
                                 .equ	RSTFLR	= 0x3b
                                 .equ	SMCR	= 0x3a
                                 .equ	OSCCAL	= 0x39
                                 .equ	CLKMSR	= 0x37
                                 .equ	CLKPSR	= 0x36
                                 .equ	PRR	= 0x35
                                 .equ	VLMCSR	= 0x34
                                 .equ	NVMCMD	= 0x33
                                 .equ	NVMCSR	= 0x32
                                 .equ	WDTCSR	= 0x31
                                 .equ	GTCCR	= 0x2f
                                 .equ	TCCR0A	= 0x2e
                                 .equ	TCCR0B	= 0x2d
                                 .equ	TCCR0C	= 0x2c
                                 .equ	TIMSK0	= 0x2b
                                 .equ	TIFR0	= 0x2a
                                 .equ	TCNT0L	= 0x28
                                 .equ	TCNT0H	= 0x29
                                 .equ	OCR0AL	= 0x26
                                 .equ	OCR0AH	= 0x27
                                 .equ	OCR0BL	= 0x24
                                 .equ	OCR0BH	= 0x25
                                 .equ	ICR0L	= 0x22
                                 .equ	ICR0H	= 0x23
                                 .equ	ACSR	= 0x1f
                                 .equ	ADCSRA	= 0x1d
                                 .equ	ADCSRB	= 0x1c
                                 .equ	ADMUX	= 0x1b
                                 .equ	ADCL	= 0x19
                                 .equ	DIDR0	= 0x17
                                 .equ	EICRA	= 0x15
                                 .equ	EIFR	= 0x14
                                 .equ	EIMSK	= 0x13
                                 .equ	PCICR	= 0x12
                                 .equ	PCIFR	= 0x11
                                 .equ	PCMSK	= 0x10
                                 .equ	PORTCR	= 0x0c
                                 .equ	PUEB	= 0x03
                                 .equ	PORTB	= 0x02
                                 .equ	DDRB	= 0x01
                                 .equ	PINB	= 0x00
                                 
                                 
                                 ; ***** BIT DEFINITIONS **************************************************
                                 
                                 ; ***** AD_CONVERTER *****************
                                 ; ADMUX - The ADC multiplexer Selection Register
                                 .equ	MUX0	= 0	; Analog Channel Selection Bits
                                 .equ	MUX1	= 1	; Analog Channel Selection Bits
                                 
                                 ; ADCSRA - The ADC Control and Status register A
                                 .equ	ADPS0	= 0	; ADC  Prescaler Select Bits
                                 .equ	ADPS1	= 1	; ADC  Prescaler Select Bits
                                 .equ	ADPS2	= 2	; ADC  Prescaler Select Bits
                                 .equ	ADIE	= 3	; ADC Interrupt Enable
                                 .equ	ADIF	= 4	; ADC Interrupt Flag
                                 .equ	ADATE	= 5	; ADC  Auto Trigger Enable
                                 .equ	ADSC	= 6	; ADC Start Conversion
                                 .equ	ADEN	= 7	; ADC Enable
                                 
                                 ; ADCSRB - The ADC Control and Status register B
                                 .equ	ADTS0	= 0	; ADC Auto Trigger Source bit 0
                                 .equ	ADTS1	= 1	; ADC Auto Trigger Source bit 1
                                 .equ	ADTS2	= 2	; ADC Auto Trigger Source bit 2
                                 
                                 ; ADCL - ADC Data Register
                                 .equ	ADC0	= 0	; ADC Data Register Bit 0
                                 .equ	ADC1	= 1	; ADC Data Register Bit 1
                                 .equ	ADC2	= 2	; ADC Data Register Bit 2
                                 .equ	ADC3	= 3	; ADC Data Register Bit 3
                                 .equ	ADC4	= 4	; ADC Data Register Bit 4
                                 .equ	ADC5	= 5	; ADC Data Register Bit 5
                                 .equ	ADC6	= 6	; ADC Data Register Bit 6
                                 .equ	ADC7	= 7	; ADC Data Register Bit 7
                                 
                                 ; DIDR0 - Digital Input Disable Register
                                 .equ	ADC0D	= 0	; 
                                 .equ	ADC1D	= 1	; 
                                 .equ	ADC2D	= 2	; 
                                 .equ	ADC3D	= 3	; 
                                 
                                 
                                 ; ***** ANALOG_COMPARATOR ************
                                 ; ACSR - Analog Comparator Control And Status Register
                                 .equ	ACIS0	= 0	; Analog Comparator Interrupt Mode Select bit 0
                                 .equ	ACIS1	= 1	; Analog Comparator Interrupt Mode Select bit 1
                                 .equ	ACIC	= 2	; Analog Comparator Input Capture  Enable
                                 .equ	ACIE	= 3	; Analog Comparator Interrupt Enable
                                 .equ	ACI	= 4	; Analog Comparator Interrupt Flag
                                 .equ	ACO	= 5	; Analog Compare Output
                                 .equ	ACD	= 7	; Analog Comparator Disable
                                 
                                 ; DIDR0 - 
                                 .equ	AIN0D	= 0	; AIN0 Digital Input Disable
                                 .equ	AIN1D	= 1	; AIN1 Digital Input Disable
                                 
                                 
                                 ; ***** CPU **************************
                                 ; CCP - Configuration Change Protection
                                 .equ	CCP0	= 0	; Configuration Change Protection bit 0
                                 .equ	CCP1	= 1	; Configuration Change Protection bit 1
                                 .equ	CCP2	= 2	; Configuration Change Protection bit 2
                                 .equ	CCP3	= 3	; Configuration Change Protection bit 3
                                 .equ	CCP4	= 4	; Configuration Change Protection bit 4
                                 .equ	CCP5	= 5	; Configuration Change Protection bit 5
                                 .equ	CCP6	= 6	; Configuration Change Protection bit 6
                                 .equ	CCP7	= 7	; Configuration Change Protection bit 7
                                 
                                 ; SREG - Status Register
                                 .equ	SREG_C	= 0	; Carry Flag
                                 .equ	SREG_Z	= 1	; Zero Flag
                                 .equ	SREG_N	= 2	; Negative Flag
                                 .equ	SREG_V	= 3	; Two's Complement Overflow Flag
                                 .equ	SREG_S	= 4	; Sign Bit
                                 .equ	SREG_H	= 5	; Half Carry Flag
                                 .equ	SREG_T	= 6	; Bit Copy Storage
                                 .equ	SREG_I	= 7	; Global Interrupt Enable
                                 
                                 ; CLKMSR - Clock Main Settings Register
                                 .equ	CLKMS0	= 0	; Clock Main Select Bit 0
                                 .equ	CLKMS1	= 1	; Clock Main Select Bit 1
                                 
                                 ; CLKPSR - Clock Prescale Register
                                 .equ	CLKPS0	= 0	; Clock Prescaler Select Bit 0
                                 .equ	CLKPS1	= 1	; Clock Prescaler Select Bit 1
                                 .equ	CLKPS2	= 2	; Clock Prescaler Select Bit 2
                                 .equ	CLKPS3	= 3	; Clock Prescaler Select Bit 3
                                 
                                 ; OSCCAL - Oscillator Calibration Value
                                 .equ	CAL0	= 0	; Oscillator Calibration Value Bit0
                                 .equ	CAL1	= 1	; Oscillator Calibration Value Bit1
                                 .equ	CAL2	= 2	; Oscillator Calibration Value Bit2
                                 .equ	CAL3	= 3	; Oscillator Calibration Value Bit3
                                 .equ	CAL4	= 4	; Oscillator Calibration Value Bit4
                                 .equ	CAL5	= 5	; Oscillator Calibration Value Bit5
                                 .equ	CAL6	= 6	; Oscillator Calibration Value Bit6
                                 .equ	CAL7	= 7	; Oscillator Calibration Value Bit7
                                 
                                 ; SMCR - Sleep Mode Control Register
                                 .equ	SE	= 0	; Sleep Enable
                                 .equ	SM0	= 1	; Sleep Mode Select Bit 0
                                 .equ	SM1	= 2	; Sleep Mode Select Bit 1
                                 .equ	SM2	= 3	; Sleep Mode Select Bit 2
                                 
                                 ; PRR - Power Reduction Register
                                 .equ	PRTIM0	= 0	; Power Reduction Timer/Counter0
                                 .equ	PRADC	= 1	; Power Reduction ADC
                                 
                                 ; VLMCSR - Vcc Level Monitoring Control and Status Register
                                 .equ	VLM0	= 0	; Trigger Level of Voltage Level Monitor bit 0
                                 .equ	VLM1	= 1	; Trigger Level of Voltage Level Monitor bit 1
                                 .equ	VLM2	= 2	; Trigger Level of Voltage Level Monitor bit 2
                                 .equ	VLMIE	= 6	; VLM Interrupt Enable
                                 .equ	VLMF	= 7	; VLM Flag
                                 
                                 ; RSTFLR - Reset Flag Register
                                 .equ	PORF	= 0	; Power-on Reset Flag
                                 .equ	EXTRF	= 1	; External Reset Flag
                                 .equ	WDRF	= 3	; Watchdog Reset Flag
                                 
                                 ; NVMCSR - Non-Volatile Memory Control and Status Register
                                 .equ	NVMBSY	= 7	; Non-Volatile Memory Busy
                                 
                                 ; NVMCMD - Non-Volatile Memory Command
                                 .equ	NVMCMD0	= 0	; 
                                 .equ	NVMCMD1	= 1	; 
                                 .equ	NVMCMD2	= 2	; 
                                 .equ	NVMCMD3	= 3	; 
                                 .equ	NVMCMD4	= 4	; 
                                 .equ	NVMCMD5	= 5	; 
                                 
                                 
                                 ; ***** PORTB ************************
                                 ; PORTCR - Port Control Register
                                 .equ	BBMB	= 1	; Break-Before-Make Mode Enable
                                 
                                 ; PUEB - Pull-up Enable Control Register
                                 .equ	PUEB0	= 0	; 
                                 .equ	PUEB1	= 1	; 
                                 .equ	PUEB2	= 2	; 
                                 .equ	PUEB3	= 3	; 
                                 
                                 ; PORTB - Input Pins, Port B
                                 .equ	PORTB0	= 0	; 
                                 .equ	PB0	= 0	; For compatibility
                                 .equ	PORTB1	= 1	; 
                                 .equ	PB1	= 1	; For compatibility
                                 .equ	PORTB2	= 2	; 
                                 .equ	PB2	= 2	; For compatibility
                                 .equ	PORTB3	= 3	; 
                                 .equ	PB3	= 3	; For compatibility
                                 
                                 ; DDRB - Data Direction Register, Port B
                                 .equ	DDB0	= 0	; 
                                 .equ	DDB1	= 1	; 
                                 .equ	DDB2	= 2	; 
                                 .equ	DDB3	= 3	; 
                                 
                                 ; PINB - Port B Data register
                                 .equ	PINB0	= 0	; 
                                 .equ	PINB1	= 1	; 
                                 .equ	PINB2	= 2	; 
                                 .equ	PINB3	= 3	; 
                                 
                                 
                                 ; ***** EXTERNAL_INTERRUPT ***********
                                 ; EICRA - External Interrupt Control Register A
                                 .equ	ISC00	= 0	; Interrupt Sense Control 0 Bit 0
                                 .equ	ISC01	= 1	; Interrupt Sense Control 0 Bit 1
                                 
                                 ; EIMSK - External Interrupt Mask register
                                 .equ	INT0	= 0	; External Interrupt Request 0 Enable
                                 
                                 ; EIFR - External Interrupt Flag register
                                 .equ	INTF0	= 0	; External Interrupt Flag 0
                                 
                                 ; PCICR - Pin Change Interrupt Control Register
                                 .equ	PCIE0	= 0	; Pin Change Interrupt Enable 0
                                 
                                 ; PCIFR - Pin Change Interrupt Flag Register
                                 .equ	PCIF0	= 0	; Pin Change Interrupt Flag 0
                                 
                                 ; PCMSK - Pin Change Mask Register
                                 .equ	PCINT0	= 0	; Pin Change Enable Mask 0
                                 .equ	PCINT1	= 1	; Pin Change Enable Mask 1
                                 .equ	PCINT2	= 2	; Pin Change Enable Mask 2
                                 .equ	PCINT3	= 3	; Pin Change Enable Mask 3
                                 
                                 
                                 ; ***** TIMER_COUNTER_0 **************
                                 ; TCCR0A - Timer/Counter 0 Control Register A
                                 .equ	WGM00	= 0	; Waveform Generation Mode
                                 .equ	WGM01	= 1	; Waveform Generation Mode
                                 .equ	COM0B0	= 4	; Compare Output Mode for Channel B bit 0
                                 .equ	COM0B1	= 5	; Compare Output Mode for Channel B bit 1
                                 .equ	COM0A0	= 6	; Compare Output Mode for Channel A bit 0
                                 .equ	COM0A1	= 7	; Compare Output Mode for Channel A bit 1
                                 
                                 ; TCCR0B - Timer/Counter 0 Control Register B
                                 .equ	CS00	= 0	; Clock Select
                                 .equ	CS01	= 1	; Clock Select
                                 .equ	CS02	= 2	; Clock Select
                                 .equ	WGM02	= 3	; Waveform Generation Mode
                                 .equ	WGM03	= 4	; Waveform Generation Mode
                                 .equ	ICES0	= 6	; Input Capture Edge Select
                                 .equ	ICNC0	= 7	; Input Capture Noise Canceler
                                 
                                 ; TCCR0C - Timer/Counter 0 Control Register C
                                 .equ	FOC0B	= 6	; Force Output Compare for Channel B
                                 .equ	FOC0A	= 7	; Force Output Compare for Channel A
                                 
                                 ; TIMSK0 - Timer Interrupt Mask Register 0
                                 .equ	TOIE0	= 0	; Overflow Interrupt Enable
                                 .equ	OCIE0A	= 1	; Output Compare A Match Interrupt Enable
                                 .equ	OCIE0B	= 2	; Output Compare B Match Interrupt Enable
                                 .equ	ICIE0	= 5	; Input Capture Interrupt Enable
                                 
                                 ; TIFR0 - Overflow Interrupt Enable
                                 .equ	TOV0	= 0	; Timer Overflow Flag
                                 .equ	OCF0A	= 1	; Timer Output Compare Flag 0A
                                 .equ	OCF0B	= 2	; Timer Output Compare Flag 0B
                                 .equ	ICF0	= 5	; Input Capture Flag
                                 
                                 ; GTCCR - General Timer/Counter Control Register
                                 .equ	PSR	= 0	; Prescaler Reset
                                 .equ	TSM	= 7	; Timer Synchronization Mode
                                 
                                 
                                 ; ***** WATCHDOG *********************
                                 ; WDTCSR - Watchdog Timer Control and Status Register
                                 .equ	WDP0	= 0	; Watch Dog Timer Prescaler bit 0
                                 .equ	WDP1	= 1	; Watch Dog Timer Prescaler bit 1
                                 .equ	WDP2	= 2	; Watch Dog Timer Prescaler bit 2
                                 .equ	WDE	= 3	; Watch Dog Enable
                                 .equ	WDP3	= 5	; Watchdog Timer Prescaler Bit 3
                                 .equ	WDIE	= 6	; Watchdog Timer Interrupt Enable
                                 .equ	WDIF	= 7	; Watchdog Timer Interrupt Flag
                                 
                                 
                                 
                                 ; ***** LOCKSBITS ********************************************************
                                 .equ	LB1	= 0	; Lockbit
                                 .equ	LB2	= 1	; Lockbit
                                 
                                 
                                 ; ***** FUSES ************************************************************
                                 ; BYTE0 fuse bits
                                 .equ	RSTDISBL	= 0	; Disable external reset
                                 .equ	WDTON	= 1	; Watch dog timer always on
                                 .equ	CKOUT	= 2	; Output external clock
                                 
                                 
                                 
                                 ; ***** CPU REGISTER DEFINITIONS *****************************************
                                 .def	XH	= r27
                                 .def	XL	= r26
                                 .def	YH	= r29
                                 .def	YL	= r28
                                 .def	ZH	= r31
                                 .def	ZL	= r30
                                 
                                 
                                 
                                 ; ***** DATA MEMORY DECLARATIONS *****************************************
                                 .equ	FLASHEND	= 0x01ff	; Note: Word address
                                 .equ	IOEND	= 0x003f
                                 .equ	SRAM_START	= 0x0040
                                 .equ	SRAM_SIZE	= 32
                                 .equ	RAMEND	= 0x005f
                                 .equ	XRAMEND	= 0x0000
                                 .equ	E2END	= 0x0000
                                 .equ	EEPROMEND	= 0x0000
                                 
                                 ; ***** MEMORY MAPPED NVM ************************************************
                                 .equ	MAPPED_FLASH_START	= 0x4000
                                 .equ	MAPPED_LOCKBITS_0	= 0x3f00
                                 .equ	MAPPED_CONFIG_0	= 0x3f40
                                 .equ	MAPPED_CALIB_0	= 0x3f80
                                 .equ	MAPPED_SIGN_0	= 0x3fc0
                                 .equ	MAPPED_SIGN_1	= 0x3fc1
                                 .equ	MAPPED_SIGN_2	= 0x3fc2
                                 .equ	MAPPED_FLASH_SIZE	= 0x0400
                                 .equ	MAPPED_FLASH_END	= 0x43ff
                                 #pragma AVRPART MEMORY PROG_FLASH 1024
                                 #pragma AVRPART MEMORY EEPROM 0
                                 #pragma AVRPART MEMORY INT_SRAM SIZE 32
                                 #pragma AVRPART MEMORY INT_SRAM START_ADDR 0x40
                                 
                                 
                                 
                                 ; ***** BOOTLOADER DECLARATIONS ******************************************
                                 .equ	PAGESIZE	= 16
                                 
                                 
                                 
                                 ; ***** INTERRUPT VECTORS ************************************************
                                 .equ	INT0addr	= 0x0001	; External Interrupt Request 0
                                 .equ	PCI0addr	= 0x0002	; Pin Change Interrupt Request 0
                                 .equ	ICP0addr	= 0x0003	; Timer/Counter0 Input Capture
                                 .equ	OVF0addr	= 0x0004	; Timer/Counter0 Overflow
                                 .equ	OC0Aaddr	= 0x0005	; Timer/Counter Compare Match A
                                 .equ	OC0Baddr	= 0x0006	; Timer/Counter Compare Match B
                                 .equ	ACIaddr	= 0x0007	; Analog Comparator
                                 .equ	WDTaddr	= 0x0008	; Watchdog Time-out
                                 .equ	VLMaddr	= 0x0009	; Vcc Voltage Level Monitor
                                 .equ	ADCCaddr	= 0x000a	; ADC Conversion Complete
                                 
                                 .equ	INT_VECTORS_SIZE	= 11	; size in words
                                 
                                 #pragma AVRPART CORE INSTRUCTIONS_NOT_SUPPORTED break
                                 
                                 #endif  /* _TN10DEF_INC_ */
                                 
                                 ; ***** END OF FILE ******************************************************
                                 
                                 .equ	LCD_CS		 = PINB0
                                 .equ	LCD_SCLK	 = PINB1
                                 .equ	LCD_SDIN	 = PINB2
                                 
                                 .equ	TFIELD_LOW	 = 0x40
                                 .equ	TFIELD_HIGH  = 0x00
                                 
                                 .equ	BTN_DOWN	 = 0x00
                                 .equ	BTN_UP		 = 0x01
                                 .equ	BTN_LEFT	 = 0x02
                                 .equ	BTN_RIGH	 = 0x03	
                                 
                                 .equ	BTN_UP_CODE		 = (1 << 7) | (0 << 6) | (0 << 5) | (0 << 4) | (0 << 3)	// blue button
                                 .equ	BTN_DOWN_CODE	 = (1 << 7) | (1 << 6) | (0 << 5) | (0 << 4) | (1 << 3)	// black button
                                 .equ	BTN_LEFT_CODE	 = (1 << 7) | (0 << 6) | (1 << 5) | (0 << 4) | (1 << 3)	// red button
                                 .equ	BTN_RIGH_CODE	 = (1 << 7) | (1 << 6) | (0 << 5) | (0 << 4) | (0 << 3)	// white button
                                 
                                 .equ	DELAY_1S		 = 10
                                 .equ	DELAY_09S		 = 9
                                 .equ	DELAY_08S		 = 8
                                 .equ	DELAY_07S		 = 7
                                 .equ	DELAY_06S		 = 6
                                 .equ	DELAY_05S		 = 5
                                 .equ	DELAY_04S		 = 4
                                 
                                 // common local
                                 .def	t_field_x		= R17
                                 .def	t_field_y		= R18
                                 
                                 .def	t_field_byte	= R25
                                 .def	t_field_addr_l	= R26
                                 .def	t_field_addr_h	= R27
                                 
                                 // CheckLine local
                                 .def	t_line			= R16
                                 .def	t_byte_tmp		= R17
                                 
                                 // ShowIntro local	
                                 .def	val_j			= R19
                                 
                                 // SendLcd8Bit local
                                 .def	arg0			= R16
                                 .def	val_i			= R17
                                 
                                 // BrickControl global
                                 .def	brick_x			= R20
                                 .def	brick_y			= R21
                                 .def	brick_type		= R22
                                 .def	brick_rot		= R23
                                 
                                 // BrickControl local
                                 .def	brick_pattern	= R16
                                 .def	tmp_x			= R17
                                 .def	tmp_y			= R18
                                 .def	pattern_pos		= R19
                                 .def	tmp_cmn			= R24
                                 
                                 // PrintNumber local
                                 .def	p_dig			= R16
                                 .def	p_pos			= R17
                                 .def	p_tmp			= R18
                                 .def	p_divr			= R19
                                 
                                 
                                 // LcdPrintField local
                                 .def	lcd_addr_cnt	= R24
                                 
                                 // main global
                                 .def	t_result		= R28
                                 .def	btn_wait		= R30
                                 .def	drop_delay		= R29
                                 .def	brick_nxt		= R31
                                 
                                 /*
                                  PB1 - DISPLAY CS
                                  PB2 - DISPLAY SCLK
                                  PB3 - DISPLAY SDIN
                                 */
                                 .cseg
                                 .org 	0x00
000000 c027                      	rjmp	_init
                                 
000001 3fa8
000002 00d3
000003 a040
000004 dac0
000005 a412                      data_lcd_init_codes: .db 0xA8, 0x3F, 0xD3, 0x00, 0x40, 0xA0, 0xC0, 0xDA, 0x12, 0xA4, 0xA6, \
000006 d5a6
000007 8d80
000008 af14
000009 0020
00000a 00e3                      						 0xD5, 0x80, 0x8D, 0x14, 0xAF, 0x20, 0x00, 0xE3, 0x00
                                 
00000b 4850
00000c 120a                      brick_type_0_0:	.db 0x50, 0x48, 0x0A, 0x12
00000d 94e0
00000e 2907                      brick_type_1_0:	.db 0xE0, 0x94, 0x07, 0x29
00000f c238
000010 431c                      brick_type_2_0:	.db 0x38, 0xC2, 0x1C, 0x43
000011 4698
000012 6219                      brick_type_3_0:	.db 0x98, 0x46, 0x19, 0x62
000013 9270
000014 9270                      brick_type_4_0:	.db 0x70, 0x92, 0x70, 0x92
000015 2ac8
000016 2ac8                      brick_type_5_0:	.db 0xC8, 0x2A, 0xC8, 0x2A
000017 e029
000018 e029                      brick_type_6_0:	.db 0x29, 0xE0, 0x29, 0xE0
                                 
                                 
000019 111f                      digit_number_0:	.db 0x1F, 0x11, 0x1F, \
00001a 001f                      					0x00, 0x1F, 0x01, \
00001b 011f
00001c 1517                      					0x17, 0x15, 0x1D, \
00001d 1f1d                      					0x1F, 0x15, 0x15, \
00001e 1515
00001f 041f                      					0x1F, 0x04, 0x07, \
000020 1d07                      					0x1D, 0x15, 0x17, \
000021 1715
000022 151d                      					0x1D, 0x15, 0x1F, \
000023 1f1f                      					0x1F, 0x01, 0x01, \
000024 0101
000025 151f                      					0x1F, 0x15, 0x1F, \
000026 1f1f
000027 1715                      					0x1F, 0x15, 0x17
                                 
                                 _init:
000028 9aff                      	sbi		ACSR, ACD							// disable comparator
                                 //-----------------init timer-----------------------
000029 2700                      	clr		R16									// TCCR0A, TCCR0C =   0
00002a bd0e                      	out		TCCR0A, R16	
00002b bd0c                      	out		TCCR0C, R16	
00002c e207                      	ldi		R16, 0x27
00002d bd07                      	out		OCR0AH, R16
00002e e00f                      	ldi		R16, 0x0F
00002f bd06                      	out		OCR0AL, R16	
000030 e00a                      	ldi		R16, (1 << WGM02) | (1 << CS01);	// WG - 0100 CTC, CS - 100 clk/8 - 8000000 / 8 = 1000000
000031 bd0d                      	out		TCCR0B, R16
                                 
                                 //-----------------init lcd display-----------------
000032 e007                      	ldi		R16, (1 << LCD_SDIN) | (1 << LCD_SCLK) | (1 << LCD_CS)
000033 b901                      	out		DDRB, R16
000034 9a10                      	sbi		PORTB, LCD_CS						// DISPLAY CS set high
000035 e0a2                      	ldi		XL,	data_lcd_init_codes * 2			// initialize X pointer
000036 e4b0                      	ldi		XH,	0x40
                                 _nxt_cfg_byte:
000037 910d                      	ld		arg0, X+
000038 9488                      	clc
000039 d1b9                      	rcall   SendLcd8Bit
00003a 3e03                      	cpi		arg0, 0xE3			
00003b f7d9                      	brne	_nxt_cfg_byte
                                 
                                 //-----------------init adc-----------------------
00003c e003                      	ldi		R16, 3
00003d bb0b                      	out		ADMUX, R16	// ADC3 PB3
00003e 2700                      	clr		R16
00003f bb0c                      	out		ADCSRB, R16 // free run
000040 e804                      	ldi		R16, (1 << ADEN) | (1 << ADPS2)
000041 bb0d                      	out		ADCSRA, R16
                                 
                                 _new_game:
000042 d062                      	rcall	LcdClearField
000043 d068                      	rcall	ShowResult
000044 e0f6                      	ldi		brick_nxt, 6
000045 e0e0                      	ldi		btn_wait, 0
                                 
                                 _press_wt:
000046 d0ad                      	rcall	Delay100us
000047 d093                      	rcall	PollButtons
000048 23ee                      	tst		btn_wait
000049 f3e1                      	breq	_press_wt
00004a d05a                      	rcall   LcdClearField
00004b e0c0                      	ldi		t_result, 0
00004c e0d7                      	ldi		drop_delay, DELAY_07S
                                 
                                 _new_brick:
00004d e0e0                      	ldi		btn_wait, 0
00004e e044                      	ldi		brick_x, 04
00004f e051                      	ldi		brick_y, (1 << 0)
000050 e070                      	ldi		brick_rot, 0
000051 2f6f                      	mov		brick_type, brick_nxt
000052 9468                      	set
000053 d0ff                      	rcall	BrickControl
000054 f368                      	brcs	_new_game
                                 
                                 _main:
000055 94e8                      	clt
000056 23ee                      	tst		btn_wait
000057 f1f9                      	breq	_btn_none
000058 d0fa                      	rcall	BrickControl
000059 9468                      	set
                                 _btn_up:
00005a ffe1                      	sbrs	btn_wait, BTN_UP
00005b c00c                      	rjmp	_btn_left
00005c 7fed                      	andi	btn_wait, ~(1 << BTN_UP)
                                 	// handle button up
00005d 3073                      	cpi		brick_rot, 3
00005e f409                      	brne	_up_rot_0
00005f ef7f                      	ser		brick_rot
                                 _up_rot_0:
000060 9573                      	inc		brick_rot
000061 d0f1                      	rcall	BrickControl
000062 f790                      	brcc	_main
000063 957a                      	dec		brick_rot
000064 fd77                      	sbrc	brick_rot, 7
000065 e073                      	ldi		brick_rot, 3
000066 d0ec                      	rcall	BrickControl
000067 cfed                      	rjmp	_main
                                 _btn_left:
000068 ffe2                      	sbrs	btn_wait, BTN_LEFT
000069 c00b                      	rjmp	_btn_right
00006a 7feb                      	andi	btn_wait, ~(1 << BTN_LEFT)
                                 	// handle button left
00006b 3047                      	cpi		brick_x, 7
00006c fd43                      	sbrc	brick_x, 3
00006d 304f                      	cpi		brick_x, 15
00006e f021                      	breq	_r_l_restore
00006f 9543                      	inc		brick_x
000070 d0e2                      	rcall	BrickControl
000071 f718                      	brcc	_main
000072 954a                      	dec		brick_x
                                 _r_l_restore:
000073 d0df                      	rcall	BrickControl
000074 cfe0                      	rjmp	_main
                                 _btn_right:
000075 ffe3                      	sbrs	btn_wait, BTN_RIGH
000076 c00b                      	rjmp	_btn_down
000077 7fe7                      	andi	btn_wait, ~(1 << BTN_RIGH)
                                 	// handle button right
000078 3040                      	cpi		brick_x, 0
000079 fd43                      	sbrc	brick_x, 3
00007a 3048                      	cpi		brick_x, 8
00007b f3b9                      	breq	_r_l_restore
00007c 954a                      	dec		brick_x
00007d d0d5                      	rcall	BrickControl
00007e f6b0                      	brcc	_main
00007f 9543                      	inc		brick_x
000080 d0d2                      	rcall	BrickControl
000081 cfd3                      	rjmp	_main
                                 _btn_down:
000082 ffe0                      	sbrs	btn_wait, BTN_DOWN
000083 c013                      	rjmp	_btn_none
000084 7fee                      	andi	btn_wait, ~(1 << BTN_DOWN)
                                 	// handle button down
000085 0f55                      	lsl		brick_y
000086 f421                      	brne	_down_8_15_p
000087 fd43                      	sbrc	brick_x, 3
000088 f039                      	breq	_x_zero
000089 6048                      	ori		brick_x, (1 << 3)	// brick_x + 8
00008a 6051                      	ori		brick_y, 1
                                 _down_8_15_p:
00008b d0c7                      	rcall	BrickControl		// set new brick
00008c f450                      	brcc	_btn_none
00008d 9556                      	lsr		brick_y
00008e f411                      	brne	_down_8_15_m
00008f 7047                      	andi	brick_x, 7			// brick_x - 8
                                 _x_zero:
000090 6850                      	ori		brick_y, (1 << 7)
                                 _down_8_15_m:
000091 d0c1                      	rcall	BrickControl		// set last brick
                                 _seek_full_line:
000092 d070                      	rcall	CheckLine
000093 95c3                      	inc		t_result
000094 f3e8                      	brcs	_seek_full_line
000095 95ca                      	dec		t_result
000096 cfb6                      	rjmp	_new_brick
                                 
                                 _btn_none:
000097 d139                      	rcall	LcdPrintField
                                 
000098 d042                      	rcall	PollButtons
                                 
000099 d05a                      	rcall	Delay100us
00009a 95da                      	dec		drop_delay
00009b f441                      	brne	_sel_done
                                 
00009c 60e1                      	ori		btn_wait, (1 << BTN_DOWN)
                                 
00009d e0d6                      	ldi		drop_delay, DELAY_06S	
00009e 32c0                      	cpi		t_result, 32
00009f f020                      	brlo	_sel_done		
0000a0 e0d5                      	ldi		drop_delay, DELAY_05S
0000a1 34c0                      	cpi		t_result, 64
0000a2 f008                      	brlo	_sel_done		
0000a3 e0d4                      	ldi		drop_delay, DELAY_04S
                                 
                                 
                                 _sel_done:
0000a4 cfb0                      	rjmp    _main
                                 
                                 
                                 /*------------------------------------------------------------------------------------*/
                                 /*
                                 input:
                                 		none
                                 output:
                                 		none
                                 */
                                 LcdClearField:
0000a5 e4a0                      	ldi		t_field_addr_l, TFIELD_LOW
0000a6 e0b0                      	ldi		t_field_addr_h, TFIELD_HIGH
0000a7 e000                      	ldi		R16, 0x00 
                                 _nxt_byte_field:
0000a8 930d                      	st		X+, R16
0000a9 35a0                      	cpi		t_field_addr_l, TFIELD_LOW + 16
0000aa f7e9                      	brne	_nxt_byte_field
0000ab 9508                      	ret
                                 
                                 /*------------------------------------------------------------------------------------*/
                                 /*
                                 input:
                                 		none
                                 output:
                                 		none
                                 */
                                 ShowResult:
                                 	// digit 0
0000ac 2700                      	clr		p_dig
0000ad e014                      	ldi		p_pos, 4
0000ae d014                      	rcall	SetPatternNumb
                                 
                                 	// digit 1
0000af e634                      	ldi		p_divr, 100
0000b0 d00b                      	rcall	_Div8
0000b1 e010                      	ldi		p_pos, 0
0000b2 d010                      	rcall	SetPatternNumb
                                 
                                 	// digit 2
0000b3 e03a                      	ldi		p_divr, 10
0000b4 d007                      	rcall	_Div8
0000b5 e01c                      	ldi		p_pos, 12
0000b6 d00c                      	rcall	SetPatternNumb
                                 
                                 	// digit 3
0000b7 2f0c                      	mov		p_dig, t_result
0000b8 e018                      	ldi		p_pos, 8
0000b9 d009                      	rcall	SetPatternNumb
                                 
0000ba d116                      	rcall	LcdPrintField
0000bb 9508                      	ret
                                 
                                 _Div8:
0000bc 2700                      	clr		p_dig
                                 _dv_nxt:	
0000bd 17c3                      	cp		t_result, p_divr
0000be f018                      	brlo	_dv_ext
0000bf 1bc3                      	sub  	t_result, p_divr
0000c0 9503                      	inc		p_dig
0000c1 cffb                      	rjmp	_dv_nxt
                                 _dv_ext:
0000c2 9508                      	ret
                                 
                                 /*------------------------------------------------------------------------------------*/
                                 /*
                                 input:
                                 		p_dig - digit to print
                                 		p_pos - right top corner of position form 0 to 15
                                 output:
                                 		none
                                 */
                                 SetPatternNumb:
0000c3 e3a2                      	ldi		XL,	LOW(digit_number_0 * 2)
0000c4 e4b0                      	ldi		XH,	HIGH(digit_number_0 * 2) | 0x40
0000c5 2f20                      	mov		p_tmp, p_dig
0000c6 0f22                      	lsl		p_tmp
0000c7 0f22                      	lsl		p_tmp
0000c8 1b20                      	sub		p_tmp, p_dig			// p_tmp = (p_dig * 4) - p_dig i,e p_tmp = p_dig * 3
0000c9 0fa2                      	add		XL, p_tmp
                                 
0000ca e4e0                      	ldi		ZL, TFIELD_LOW
0000cb e0f0                      	ldi		ZH, TFIELD_HIGH
0000cc 0fe1                      	add		ZL, p_pos
                                 
0000cd 912d                      	ld		p_tmp, X+
0000ce 9321                      	st		Z+, p_tmp
0000cf 912d                      	ld		p_tmp, X+
0000d0 9321                      	st		Z+, p_tmp
0000d1 912d                      	ld		p_tmp, X+
0000d2 9321                      	st		Z+, p_tmp
                                 
0000d3 9508                      	ret
                                 
                                 /*------------------------------------------------------------------------------------*/
                                 /*
                                 input:
                                 		none
                                 output:
                                 		none
                                 */
                                 /*
                                 ShowIntro:
                                 	cpi		drop_delay, 7
                                 	brlo	_si_delay
                                 
                                 	clr		val_j
                                 _si_nxt_bt:
                                 	ldi		XL,	LOW(logo_arrow * 2)
                                 	ldi		XH,	HIGH(logo_arrow * 2) | 0x40
                                 	brtc	_si_tc
                                 	ldi		XL,	LOW(logo_push * 2)
                                 _si_tc:
                                 	add		XL, val_j
                                 	ld		arg0, X
                                 	ldi		XL,	TFIELD_LOW
                                 	ldi		XH,	TFIELD_HIGH
                                 	add		XL, val_j
                                 	st		X, arg0
                                 	inc		val_j
                                 	cpi		val_j, 16
                                 	brne	_si_nxt_bt
                                 
                                 	rcall	LcdPrintField
                                 
                                 	//invert	SREG.T
                                 	in		arg0, SREG
                                 	set
                                 	sbrc	arg0, 6
                                 	clt
                                 	ser		drop_delay
                                 _si_delay:
                                 	inc		drop_delay
                                 	ret
                                 
                                 logo_arrow:	.db 0x00, 0x00, 0xFC, 0xFC, 0xFC, 0xFC, 0x00, 0x00, \
                                 			    0x04, 0x0C, 0x1F, 0x3F, 0x3F, 0x1F, 0x0C, 0x04
                                 
                                 logo_push:  .db 0x3E, 0x20, 0x3E, 0x00, 0x00, 0x0E, 0x0A, 0x3E, \
                                 				0x1F, 0x04, 0x1F, 0x00, 0x00, 0x1D, 0x15, 0x17
                                 */
                                 /*------------------------------------------------------------------------------------*/
                                 /*
                                 input:
                                 		none
                                 output:
                                 		arg0 adc val
                                 */
                                 GetAdcVal:
0000d4 ec04                      	ldi		R16, (1 << ADEN) | (1 << ADPS2)	| (1 << ADSC)	
0000d5 bb0d                      	out		ADCSRA, R16
                                 _gav_nxt:
0000d6 b30d                      	in		R16, ADCSRA
0000d7 7400                      	andi	R16, (1 << ADSC)
0000d8 f7e9                      	brne	_gav_nxt
0000d9 b309                      	in		R16, ADCL
0000da 9508                      	ret
                                 
                                 /*------------------------------------------------------------------------------------*/
                                 /*
                                 input:
                                 		none
                                 output:
                                 		btn_wait buttons state
                                 */
                                 PollButtons:
0000db dff8                      	rcall	GetAdcVal
0000dc 7f08                      	andi	arg0, 0xF8
                                 _pb_btn_up:
0000dd 3800                      	cpi		arg0, BTN_UP_CODE
0000de f411                      	brne	_pb_btn_down
0000df 60e2                      	ori		btn_wait, (1 << BTN_UP)
0000e0 d01e                      	rcall	BrickNextCounter
                                 _pb_btn_down:
0000e1 3c08                      	cpi		arg0, BTN_DOWN_CODE
0000e2 f419                      	brne	_pb_btn_left
0000e3 60e1                      	ori		btn_wait, (1 << BTN_DOWN)
0000e4 d01a                      	rcall	BrickNextCounter
0000e5 d019                      	rcall	BrickNextCounter
                                 _pb_btn_left:
0000e6 3a08                      	cpi		arg0, BTN_LEFT_CODE
0000e7 f421                      	brne	_pb_btn_righ
0000e8 60e4                      	ori		btn_wait, (1 << BTN_LEFT)
0000e9 d015                      	rcall	BrickNextCounter
0000ea d014                      	rcall	BrickNextCounter
0000eb d013                      	rcall	BrickNextCounter
                                 _pb_btn_righ:
0000ec 3c00                      	cpi		arg0, BTN_RIGH_CODE
0000ed f429                      	brne	_pb_ext
0000ee 60e8                      	ori		btn_wait, (1 << BTN_RIGH)
0000ef d00f                      	rcall	BrickNextCounter
0000f0 d00e                      	rcall	BrickNextCounter
0000f1 d00d                      	rcall	BrickNextCounter
0000f2 d00c                      	rcall	BrickNextCounter
                                 _pb_ext:
0000f3 9508                      	ret
                                 
                                 /*------------------------------------------------------------------------------------*/
                                 /*
                                 input:
                                 		none
                                 output:
                                 		none
                                 */
                                 Delay100us:
0000f4 e207                      	ldi		R16, 0x27
0000f5 bd07                      	out		OCR0AH, R16
0000f6 e00f                      	ldi		R16, 0x0F
0000f7 bd06                      	out		OCR0AL, R16				
                                 
0000f8 e002                      	ldi		R16, (1 << OCF0A)
0000f9 bd0a                      	out		TIFR0, R16
                                 
                                 _dl:
0000fa b50a                      	in		R16, TIFR0
0000fb ff01                      	sbrs	R16, 1
0000fc cffd                      	rjmp	_dl
                                 
0000fd d001                      	rcall	BrickNextCounter
                                 
0000fe 9508                      	ret
                                 
                                 
                                 /*------------------------------------------------------------------------------------*/
                                 /*
                                 input:
                                 		none
                                 output:
                                 		none
                                 */
                                 BrickNextCounter:
0000ff 95fa                      	dec		brick_nxt
000100 fdf7                      	sbrc	brick_nxt, 7
000101 e0f6                      	ldi		brick_nxt, 6
000102 9508                      	ret
                                 
                                 /*------------------------------------------------------------------------------------*/
                                 /*
                                 input:
                                 		none
                                 output:
                                 		SREG.C - 1 full line found and removed, 0 no full lines
                                 */
                                 CheckLine:
000103 94e8                      	clt											// T = 0 - from 0 to 7, 1 from 8 to 15
000104 e4a0                      	ldi		t_field_addr_l, TFIELD_LOW
000105 e0b0                      	ldi		t_field_addr_h, TFIELD_HIGH
000106 fdb0                      	sbrc	t_field_addr_h, 0
                                 _cl_sek_full_line:
000107 9468                      	set
000108 ef0f                      	ser		t_line
                                 _cl_nxt_colmn_check:
000109 919d                      	ld		t_field_byte, X+	
00010a 2309                      	and		t_line, t_field_byte
00010b 34a8                      	cpi		t_field_addr_l, TFIELD_LOW + 8
00010c f011                      	breq	_cl_tst_line
00010d 35a0                      	cpi		t_field_addr_l, TFIELD_LOW + 16
00010e f7d1                      	brne	_cl_nxt_colmn_check
                                 _cl_tst_line:
00010f 3000                      	cpi		t_line, 0
000110 f419                      	brne	_cl_shft_cycle
000111 f7ae                      	brtc	_cl_sek_full_line
000112 9488                      	clc
000113 9508                      	ret
                                 _cl_shft_cycle:
000114 e4a0                      	ldi		t_field_addr_l, TFIELD_LOW	
000115 f40e                      	brtc	_cl_nxt_colmn_shft
000116 60a8                      	ori		t_field_addr_l, (1 << 3)			// 8_15 field
                                 _cl_nxt_colmn_shft:
000117 919c                      	ld		t_field_byte, X
000118 2f19                      	mov		t_byte_tmp, t_field_byte
000119 0f11                      	lsl		t_byte_tmp
                                 
00011a fd07                      	sbrc	t_line, 7
00011b c026                      	rjmp	_cl_80
00011c fd06                      	sbrc	t_line, 6
00011d c020                      	rjmp	_cl_40
00011e fd05                      	sbrc	t_line, 5
00011f c01a                      	rjmp	_cl_20
000120 fd04                      	sbrc	t_line, 4
000121 c014                      	rjmp	_cl_10
000122 fd03                      	sbrc	t_line, 3
000123 c00e                      	rjmp	_cl_08
000124 fd02                      	sbrc	t_line, 2
000125 c008                      	rjmp	_cl_04
000126 fd01                      	sbrc	t_line, 1
000127 c002                      	rjmp	_cl_02
                                 
                                 _cl_01:
000128 7f9e                      	andi	t_field_byte, 0xFE
000129 c019                      	rjmp	_cl_low_shft
                                 _cl_02:
00012a 7f9c                      	andi	t_field_byte, 0xFC
00012b 7013                      	andi	t_byte_tmp, 0x03
00012c 2b91                      	or		t_field_byte, t_byte_tmp	
00012d c015                      	rjmp	_cl_low_shft
                                 _cl_04:
00012e 7f98                      	andi	t_field_byte, 0xF8
00012f 7017                      	andi	t_byte_tmp, 0x07
000130 2b91                      	or		t_field_byte, t_byte_tmp	
000131 c011                      	rjmp	_cl_low_shft
                                 _cl_08:
000132 7f90                      	andi	t_field_byte, 0xF0
000133 701f                      	andi	t_byte_tmp, 0x0F
000134 2b91                      	or		t_field_byte, t_byte_tmp	
000135 c00d                      	rjmp	_cl_low_shft
                                 _cl_10:
000136 7e90                      	andi	t_field_byte, 0xE0
000137 711f                      	andi	t_byte_tmp, 0x1F
000138 2b91                      	or		t_field_byte, t_byte_tmp	
000139 c009                      	rjmp	_cl_low_shft
                                 _cl_20:
00013a 7c90                      	andi	t_field_byte, 0xC0
00013b 731f                      	andi	t_byte_tmp, 0x3F
00013c 2b91                      	or		t_field_byte, t_byte_tmp	
00013d c005                      	rjmp	_cl_low_shft
                                 _cl_40:
00013e 7890                      	andi	t_field_byte, 0x80
00013f 771f                      	andi	t_byte_tmp, 0x7F
000140 2b91                      	or		t_field_byte, t_byte_tmp	
000141 c001                      	rjmp	_cl_low_shft
                                 _cl_80:
000142 0f99                      	lsl		t_field_byte
                                 _cl_low_shft:
000143 f43e                      	brtc	_cl_nxt_colmn_cont
                                 
                                 	// if 8_15 field was shifted we have to shift 0_7 field too
000144 7fa7                      	andi	t_field_addr_l, ~(1 << 3)
000145 911c                      	ld		t_byte_tmp, X
000146 fd17                      	sbrc	t_byte_tmp, 7
000147 6091                      	ori		t_field_byte, 01
000148 0f11                      	lsl		t_byte_tmp
000149 931c                      	st		X, t_byte_tmp
00014a 60a8                      	ori		t_field_addr_l, (1 << 3)
                                 
                                 _cl_nxt_colmn_cont:
00014b 939d                      	st		X+, t_field_byte
00014c 34a8                      	cpi		t_field_addr_l, TFIELD_LOW + 8
00014d f248                      	brlo	_cl_nxt_colmn_shft
00014e f416                      	brtc	_cl_ext_c1
                                 _cl_8_15:
00014f 35a0                      	cpi		t_field_addr_l, TFIELD_LOW + 16
000150 f631                      	brne	_cl_nxt_colmn_shft
                                 _cl_ext_c1:
000151 9408                      	sec
000152 9508                      	ret
                                 /*------------------------------------------------------------------------------------*/
                                 /*
                                 input:
                                 		brick_x - from 0 to 15
                                 		brick_y - from 00000001 to 10000000
                                 		brick_type - from 0 to 4
                                 		brick_rot - from 0 to 3
                                 		SREG.T
                                 	    0		just clean brick fields
                                 		1       check fields for brick & set brick in fields
                                 output:
                                 		SREG.C - 1 fields already set , 0 move/rotate done
                                 */
                                 BrickControl:
000153 e1a6                      	ldi		XL,	brick_type_0_0 * 2
000154 e4b0                      	ldi		XH,	0x40
000155 2f06                      	mov		brick_pattern, brick_type
000156 0f00                      	lsl		brick_pattern
000157 0f00                      	lsl		brick_pattern						// brick_type * 4
000158 0fa0                      	add		XL, brick_pattern
000159 0fa7                      	add		XL, brick_rot						// brick_type * 4 + brick_rot
00015a 910c                      	ld		brick_pattern, X					// brick_pattern[brick_type * 4 + brick_rot]
00015b e031                      	ldi		pattern_pos, 1						// pattern position 00000001
                                 _bc_nxt_seg:
00015c 2f83                      	mov		tmp_cmn, pattern_pos
00015d 2380                      	and		tmp_cmn, brick_pattern
00015e f409                      	brne	_bc_x_if_six
00015f c04f                      	rjmp	_bc_cont
                                 _bc_x_if_six:
000160 2f14                      	mov		tmp_x, brick_x
000161 3066                      	cpi		brick_type,  6						// hack for horizontal x4 bar
000162 f449                      	brne	_bc_get_x
000163 fd70                      	sbrc	brick_rot, 0						// x only for 0,2 position
000164 c017                      	rjmp	_bc_y_if_six
000165 fd35                      	sbrc	pattern_pos, 5
000166 5013                      	subi	tmp_x, 3
000167 fd33                      	sbrc	pattern_pos, 3
000168 5012                      	subi	tmp_x, 2
000169 fd30                      	sbrc	pattern_pos, 0
00016a 951a                      	dec		tmp_x
00016b c00a                      	rjmp	_bc_check_x
                                 _bc_get_x:
                                 	// get x coordinate from pattern position
00016c e984                      	ldi		tmp_cmn, (4 | 16 | 128) 
00016d 2383                      	and		tmp_cmn, pattern_pos
00016e f421                      	brne	_bc_x_p_1
                                 
00016f e289                      	ldi		tmp_cmn, (1 | 8 | 32)	
000170 2383                      	and		tmp_cmn, pattern_pos
000171 f419                      	brne	_bc_x_m_1
                                 
000172 c003                      	rjmp	_bc_check_x							 // (2 | 64) 
                                 
                                 _bc_x_p_1:
000173 9513                      	inc		tmp_x
000174 c001                      	rjmp	_bc_check_x
                                 
                                 _bc_x_m_1:
000175 951a                      	dec		tmp_x
                                 
                                 _bc_check_x:
000176 2f81                      	mov		tmp_cmn, tmp_x						// aka push
000177 2714                      	eor		tmp_x, brick_x
000178 7018                      	andi	tmp_x, (1 << 3)
000179 2f18                      	mov		tmp_x, tmp_cmn						// aka pop
00017a f009                      	breq	_bc_y_if_six					 
00017b c042                      	rjmp	_bc_ext_err							// tmp_x > 7 || tmp_x < 0
                                 
                                 _bc_y_if_six:
00017c 2f25                      	mov		tmp_y, brick_y
00017d 3066                      	cpi		brick_type,  6						// hack for vertical x4 bar
00017e f449                      	brne	_bc_get_y
00017f ff70                      	sbrs	brick_rot, 0						// y only for 1,3 position
000180 c029                      	rjmp	_bc_tst_field_bit
000181 fd37                      	sbrc	pattern_pos, 7
000182 c00c                      	rjmp	_bc_y_p_3
000183 fd36                      	sbrc	pattern_pos, 6
000184 c00d                      	rjmp	_bc_y_p_2
000185 fd35                      	sbrc	pattern_pos, 5
000186 c00e                      	rjmp	_bc_y_p_1
000187 c022                      	rjmp	_bc_tst_field_bit
                                 
                                 _bc_get_y:
                                 	// get y coordinate from pattern position
000188 ee80                      	ldi		tmp_cmn, (32 | 64 | 128) 
000189 2383                      	and		tmp_cmn, pattern_pos
00018a f451                      	brne	_bc_y_p_1
                                 	
00018b e087                      	ldi		tmp_cmn, (1 | 2 | 4) 
00018c 2383                      	and		tmp_cmn, pattern_pos
00018d f499                      	brne	_bc_y_m_1
                                 									 
00018e c01b                      	rjmp	_bc_tst_field_bit					// (8 | 16) 
                                 
                                 _bc_y_p_3:
00018f 0f22                      	lsl		tmp_y
000190 f409                      	brne	_bc_y_p_2
000191 d007                      	rcall	_bc_y_p_carry
                                 _bc_y_p_2:
000192 0f22                      	lsl		tmp_y
000193 f409                      	brne	_bc_y_p_1
000194 d004                      	rcall	_bc_y_p_carry
                                 _bc_y_p_1:
000195 0f22                      	lsl		tmp_y
000196 f499                      	brne	_bc_tst_field_bit
000197 d001                      	rcall	_bc_y_p_carry
000198 c011                      	rjmp	_bc_tst_field_bit
                                 _bc_y_p_carry:
000199 ff13                      	sbrs	tmp_x, 3
00019a c003                      	rjmp	_bc_y_p_carry_k	
00019b 911f                      	pop		tmp_x								// just remove ret addr from stack low
00019c 911f                      	pop		tmp_x								// just remove ret addr from stack high
00019d c020                      	rjmp	_bc_ext_err
                                 _bc_y_p_carry_k:
00019e 6018                      	ori		tmp_x, (1 << 3)						// tmp_x + 8
00019f 6021                      	ori		tmp_y, 1
0001a0 9508                      	ret
                                 
                                 _bc_y_m_1:	
0001a1 2f25                      	mov		tmp_y, brick_y
0001a2 3066                      	cpi		brick_type,  6						// hack for vertical x4 bar
0001a3 f359                      	breq	_bc_y_p_3
0001a4 9526                      	lsr		tmp_y
0001a5 f421                      	brne	_bc_tst_field_bit
0001a6 ff13                      	sbrs	tmp_x, 3
0001a7 c016                      	rjmp	_bc_ext_err
0001a8 7017                      	andi	tmp_x, 7							// brick_x - 8
0001a9 6820                      	ori		tmp_y, (1 << 7)
                                 
                                 _bc_tst_field_bit: 
0001aa f41e                      	brtc	_bc_clear	
0001ab d014                      	rcall	GetFieldBit	
0001ac f489                      	brne	_bc_ext_err
0001ad f40f                      	brid	_bc_cont
                                 _bc_clear:
0001ae d017                      	rcall	SetFieldBit
                                 
                                 _bc_cont:
0001af 0f33                      	lsl		pattern_pos
0001b0 f009                      	breq	_bc_act
0001b1 cfaa                      	rjmp	_bc_nxt_seg
                                 _bc_act:
0001b2 2f14                      	mov		t_field_x, brick_x
0001b3 2f25                      	mov		t_field_y, brick_y
0001b4 f42e                      	brtc	_bc_center_bit
0001b5 d00a                      	rcall	GetFieldBit							// test center field 
0001b6 f439                      	brne	_bc_ext_err
0001b7 f017                      	brie	_bc_center_bit
0001b8 9478                      	sei
0001b9 cf99                      	rjmp	BrickControl
                                 _bc_center_bit:
0001ba d00b                      	rcall	SetFieldBit
0001bb 94f8                      	cli
                                 _bc_ext_ok:
0001bc 9488                      	clc
0001bd 9508                      	ret
                                 _bc_ext_err:
0001be 9408                      	sec
0001bf 9508                      	ret
                                 
                                 /*------------------------------------------------------------------------------------*/
                                 /*
                                 input:	
                                 		t_field_x - from 0 to 15
                                 		t_field_y - from 00000001 to 10000000
                                 output:
                                 		SREG.Z - 1 clear, 0 set
                                 */
                                 GetFieldBit:
0001c0 e4a0                      	ldi		t_field_addr_l, TFIELD_LOW
0001c1 0fa1                      	add		t_field_addr_l, t_field_x
0001c2 e0b0                      	ldi		t_field_addr_h, TFIELD_HIGH
0001c3 919c                      	ld		t_field_byte, X				
0001c4 2392                      	and		t_field_byte, t_field_y
0001c5 9508                      	ret
                                 
                                 /*------------------------------------------------------------------------------------*/
                                 /*
                                 input:	
                                 		t_field_x - from 0 to 15
                                 		t_field_y - from 00000001 to 10000000
                                 		SREG.T - 1 set, 0 clear
                                 output:
                                 		none
                                 */
                                 SetFieldBit:
0001c6 e4a0                      	ldi		t_field_addr_l, TFIELD_LOW
0001c7 2ba1                      	or		t_field_addr_l, t_field_x		// instead add instruction, because add interact with C flag (use carefully)
0001c8 e0b0                      	ldi		t_field_addr_h, TFIELD_HIGH
0001c9 919c                      	ld		t_field_byte, X			
0001ca 2b92                      	or		t_field_byte, t_field_y
0001cb f01e                      	brts	_sfb_set
0001cc 9520                      	com		t_field_y
0001cd 2392                      	and		t_field_byte, t_field_y
0001ce 9520                      	com		t_field_y
                                 _sfb_set:
0001cf 939c                      	st		X, t_field_byte
0001d0 9508                      	ret
                                 
                                 /*------------------------------------------------------------------------------------*/
                                 /*
                                 input:	
                                 		none
                                 output:
                                 		none
                                 */
                                 LcdPrintField:
0001d1 e3af                      	ldi		t_field_addr_l, TFIELD_LOW - 1
                                 _lpf_nxt_byte:
0001d2 e0b0                      	ldi		t_field_addr_h, TFIELD_HIGH
0001d3 e080                      	ldi		lcd_addr_cnt, 0
0001d4 95a3                      	inc		t_field_addr_l
                                 
                                 _lpf_get_byte:
0001d5 919c                      	ld		t_field_byte, X
0001d6 3480                      	cpi		lcd_addr_cnt, 64
0001d7 f020                      	brlo	_lpf_get_bit
0001d8 e008                      	ldi		arg0, 8
0001d9 0fa0                      	add		t_field_addr_l, arg0
0001da 919c                      	ld		t_field_byte, X
0001db 1ba0                      	sub		t_field_addr_l, arg0
                                 _lpf_get_bit:
0001dc e000                      	ldi		arg0, 0x00
0001dd 939f                      	push	t_field_byte
0001de 2b08                      	or		arg0, lcd_addr_cnt
0001df 730f                      	andi	arg0, 0x3F	
0001e0 f019                      	breq	_lpf_lcd_val
                                 _lpf_lsr:
0001e1 9596                      	lsr		t_field_byte
0001e2 5008                      	subi	arg0, 8
0001e3 f7e9                      	brne	_lpf_lsr
                                 _lpf_lcd_val:
0001e4 e000                      	ldi		arg0, 0x00
0001e5 fd90                      	sbrc	t_field_byte, 0
0001e6 ef0f                      	ldi		arg0, 0xFF
0001e7 919f                      	pop		t_field_byte
                                 _lpf_nxt_print:
0001e8 9408                      	sec
0001e9 d009                      	rcall	SendLcd8Bit
0001ea 9583                      	inc		lcd_addr_cnt
0001eb e0b7                      	ldi		t_field_addr_h, 7
0001ec 23b8                      	and		t_field_addr_h, lcd_addr_cnt	// check if lcd_addr_cnt multiple of 8
0001ed f7d1                      	brne	_lpf_nxt_print
0001ee 3880                      	cpi		lcd_addr_cnt, 128				// check if we reached last row
0001ef f729                      	brne    _lpf_get_byte
0001f0 34a7                      	cpi		t_field_addr_l, TFIELD_LOW + 7  // check if we print all tetris fiels (8 columns)
0001f1 f701                      	brne	_lpf_nxt_byte
                                 _lpf_ext:
0001f2 9508                      	ret
                                 
                                 /*------------------------------------------------------------------------------------*/
                                 /*
                                 input:
                                 		arg0 - data8bit
                                 		SREG.C - 1 data, 0 - cmd
                                 output:
                                 		none
                                 */
                                 SendLcd8Bit:
0001f3 9810                      	cbi		PORTB, LCD_CS		// DISPLAY CS set low
0001f4 e01a                      	ldi		val_i, 10
                                 _slbc_nxt:
0001f5 9811                      	cbi		PORTB, LCD_SCLK		// DISPLAY SCLK set low
0001f6 9812                      	cbi		PORTB, LCD_SDIN
0001f7 951a                      	dec		val_i
0001f8 f029                      	breq	_slbc_ext
0001f9 f408                      	brcc	_slbc_bt0
0001fa 9a12                      	sbi		PORTB, LCD_SDIN
                                 _slbc_bt0:
0001fb 9a11                      	sbi		PORTB, LCD_SCLK		// DISPLAY SCLK set high
0001fc 1f00                      	rol 	arg0
0001fd cff7                      	rjmp	_slbc_nxt
                                 _slbc_ext:
0001fe 9a10                      	sbi		PORTB, LCD_CS		// DISPLAY CS set high
0001ff 9508                      	ret
                                 


RESOURCE USE INFORMATION
------------------------

Notice:
The register and instruction counts are symbol table hit counts,
and hence implicitly used resources are not counted, eg, the
'lpm' instruction without operands implicitly uses r0 and z,
none of which are counted.

x,y,z are separate entities in the symbol table and are
counted separately from r26..r31 here.

.dseg memory usage only counts static data declared with .byte

"ATtiny10" register use summary:
x  :  16 y  :   0 z  :   3 r0 :   0 r1 :   0 r2 :   0 r3 :   0 r4 :   0 
r5 :   0 r6 :   0 r7 :   0 r8 :   0 r9 :   0 r10:   0 r11:   0 r12:   0 
r13:   0 r14:   0 r15:   0 r16:  71 r17:  44 r18:  25 r19:  17 r20:  17 
r21:   8 r22:   5 r23:  10 r24:  18 r25:  32 r26:  26 r27:  11 r28:   8 
r29:   5 r30:  19 r31:   6 
Registers used: 18 out of 35 (51.4%)

"ATtiny10" instruction use summary:
.lds.l:   0 .sts.l:   0 adc   :   0 add   :   6 and   :   9 andi  :  24 
asr   :   0 bclr  :   0 bld   :   0 brbc  :   0 brbs  :   0 brcc  :   5 
brcs  :   2 breq  :  11 brge  :   0 brhc  :   0 brhs  :   0 brid  :   1 
brie  :   1 brlo  :   5 brlt  :   0 brmi  :   0 brne  :  31 brpl  :   0 
brsh  :   0 brtc  :   6 brts  :   1 brvc  :   0 brvs  :   0 bset  :   0 
bst   :   0 cbi   :   3 cbr   :   0 clc   :   3 clh   :   0 cli   :   1 
cln   :   0 clr   :   4 cls   :   0 clt   :   2 clv   :   0 clz   :   0 
com   :   2 cp    :   1 cpc   :   0 cpi   :  24 cpse  :   0 dec   :   9 
eor   :   1 icall :   0 ijmp  :   0 in    :   3 inc   :   8 ld    :  12 
ldd   :   0 ldi   :  61 lds   :   0 lsl   :  12 lsr   :   3 mov   :  13 
neg   :   0 nop   :   0 or    :   9 ori   :  14 out   :  13 pop   :   3 
push  :   1 rcall :  47 ret   :  17 reti  :   0 rjmp  :  45 rol   :   1 
ror   :   0 sbc   :   0 sbci  :   0 sbi   :   5 sbic  :   0 sbis  :   0 
sbr   :   0 sbrc  :  22 sbrs  :   8 sec   :   3 seh   :   0 sei   :   1 
sen   :   0 ser   :   2 ses   :   0 set   :   3 sev   :   0 sez   :   0 
sleep :   0 st    :   7 std   :   0 sts   :   0 sub   :   3 subi  :   3 
swap  :   0 tst   :   2 wdr   :   0 
Instructions used: 49 out of 99 (49.5%)

"ATtiny10" memory use summary [bytes]:
Segment   Begin    End      Code   Data   Used    Size   Use%
---------------------------------------------------------------
[.cseg] 0x000000 0x000400    946     78   1024    1024 100.0%
[.dseg] 0x000040 0x000060      0      0      0      32   0.0%
[.eseg] 0x000000 0x000000      0      0      0       0      -

Assembly complete, 0 errors, 18 warnings
